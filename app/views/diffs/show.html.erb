<p id="notice"><%= notice %></p>

<div id="diff_html"></div>
<div id="diff_string" style="display:none"><%= @diff.content.html_safe %></div>

<%= link_to 'Edit', edit_diff_path(@diff) %> |
<%= link_to 'Back', diffs_path %>

<script>
  // base template ref: https://github.com/rtfpessoa/diff2html/blob/master/src/templates/side-by-side-file-diff.mustache
  var rawTemplates = {
    'side-by-side-file-diff': (function () {/*
<div id="{{fileHtmlId}}" class="d2h-file-wrapper" data-lang="{{file.language}}">
    <div class="d2h-file-header">
      {{{filePath}}}
    </div>
    <div class="d2h-files-diff">
        <div class="d2h-file-side-diff">
            <div class="d2h-code-wrapper">
                <table class="d2h-diff-table">
                    <tbody class="d2h-diff-tbody">
                    {{{diffs.left}}}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="d2h-file-side-diff">
            <div class="d2h-code-wrapper">
                <table class="d2h-diff-table">
                    <tbody class="d2h-diff-tbody">
                    {{{diffs.right}}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
*/}).toString().match(/(?:\/\*(?:[\s\S]*?)\*\/)/).pop().replace(/^\/\*/, "").replace(/\*\/$/, "")
  };
  var diff_string = document.getElementById("diff_string").innerText
  var diffHtml = Diff2Html.getPrettyHtml(
    diff_string,
    {inputFormat: 'diff', showFiles: true, matching: 'lines', outputFormat: 'side-by-side', rawTemplates: rawTemplates }
  );
  document.getElementById("diff_html").innerHTML = diffHtml;
</script>
